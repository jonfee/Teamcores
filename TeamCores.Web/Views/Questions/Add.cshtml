@{
    ViewData["Title"] = "新增考题";
}
@section head_script
    {
    <script src="~/js/pattern.js"></script>
}
@section style{
    <link href="~/css/question/add.css" lang="scss" rel="stylesheet" />
}
<div class="content-body">
    <i-form ref="formValidate" :model="question" :rules="validateRules" :label-width="80">
        <Form-item class="w-48" label="题目" prop="Topic">
            <i-input v-model="question.Topic" placeholder="题目"></i-input>
        </Form-item>
        <Form-item class="w-48" label="所属课程" prop="CourseId">
            <i-select v-model="question.CourseId">
                <i-option v-for="item in courses" :value="item.CourseId" :key="item.CourseId">{{item.Title}}</i-option>
            </i-select>
        </Form-item>
        <Form-item class="w-48" label="题目类型" prop="Type">
            <i-select v-model="question.Type">
                <i-option v-for="item in QuestionType.items" :value="item.value" :key="item.value">{{item.text}}</i-option>
            </i-select>
        </Form-item>

        <Form-item class="w-48" label="选项与答案" prop="AnswerOptions">
            <div class="answer-options">
                <ul class="tab-list">
                    <li v-for="(item, index) in answeroptions" :key="index">
                        <template v-if="index == answeroptions.length - 1">
                            <span>
                                <i-input v-model="item.name" placeholder="请输入参数类型" :maxlength="6" />
                            </span>
                            <span :title="item.value">
                                <i-input v-model="item.value" placeholder="请输入参数" :maxlength="30" />
                            </span>
                        </template>
                        <template v-else>
                            <span>{{item.name}}</span>
                            <span :title="item.value">{{item.value}}</span>
                        </template>
                        <i-button type="text" v-on:click="onRemoveOption(index)">
                            <Icon type="close-circled"></Icon>
                        </i-button>
                    </li>
                    <li v-if="answeroptions.length <= 9" class="add">
                        <a href="javascript:void(0)" v-on:click="onAddOption">+</a>
                    </li>
                </ul>
            </div>
        </Form-item>

        <Form-item class="w-48 float-right">
            <i-button type="primary" v-on:click="handleSubmit('formValidate')">提交</i-button>
            <i-button type="ghost" v-on:click="handleReset('formValidate')" style="margin-left : 8px">重置</i-button>
        </Form-item>
    </i-form>
</div>
@section title_actions{
    <i-button type="success" v-on:click="goList">返回列表</i-button>
}
@section page_script{
    <script>
        var vm = new Vue({
            el: '#content',
            data: {
                subjects: {},
                courses: {},
                // 考题对象
                question: {
                    CourseId: 0,
                    Topic: "",
                    Type: 0,
                    AnswerOptions: {},
                },
                answeroptions: [
                    {
                        name: 'A',
                        value: '深圳'
                    },
                    {
                        name: 'B',
                        value: '广州'
                    }
                ], // 答案集合
                // 验证规则
                validateRules: {
                    Topic:
                    [
                        {
                            required: true,
                            message: "题目主题不能为空"
                        }
                    ],
                    CourseId: [
                        {
                            required: true,
                            message: "请选择所属课程"
                        }
                    ],
                    Type: [
                        {
                            required: true,
                            message: "请选择题目类型"
                        }
                    ]
                }
            },
            created() {
                this.getCourses();
            },
            methods: {
                goList() {
                    location = "/questions/index";
                },
                /**
                 * 保存
                 * @@param name 表单名称
                 */
                handleSubmit(name) {
                    this.$refs[name].validate((valid) => {
                        if (valid) {
                            Ajax.post({
                                url: '/api/question/add',
                                data: this.course,
                                success: (response) => {
                                    var data = response.data;
                                    if (!data.Error) {
                                        this.$Message.success("添加成功!");
                                        setTimeout(() => {
                                            location = "/questions/index";
                                        },
                                            1000);
                                    }
                                    else {
                                        this.$Message.error(data.Message);
                                    }
                                },
                                error: (error) => {
                                    this.$Message.error('操作失败，请重试！');
                                }
                            });
                        }
                    });
                },
                /**
                 * 重置
                 * @@param name 表单名称
                 */
                handleReset(name) {
                    this.$refs[name].resetFields();
                },
                /**
                 * 获取所有的课程
                 */
                getCourses() {
                    var _this = this;
                    Ajax.post({
                        url: "/api/course/search",
                        data: {
                            pageIndex: 1,
                            pageSize: 100
                        },
                        success: (response) => {
                            var data = response.data;
                            if (!data.Error) {
                                const pager = data.Data;
                                _this.courses = pager.Table;
                            }
                        },
                        error: (error) => {
                        }
                    });
                },
                /**
                 * 删除选项
                 */
                onRemoveOption(index) {
                    const _this = this;
                },
                /**
                 * 删除选项
                 */
                onAddOption() {
                }

            }
        });
    </script>
}